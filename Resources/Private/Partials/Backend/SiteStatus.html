<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      data-namespace-typo3-fluid="true">

<div class="ignitercf-site-status card mb-3" data-site-identifier="{site.identifier}">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0">
                <f:if condition="{site.isConfigured}">
                    <f:then>
                        <span class="text-success">
                            <core:icon identifier="actions-check-circle" size="small" />
                        </span>
                    </f:then>
                    <f:else>
                        <span class="text-warning">
                            <core:icon identifier="actions-exclamation-circle" size="small" />
                        </span>
                    </f:else>
                </f:if>
                {site.identifier}
                <small class="text-muted">({site.baseUrl})</small>
            </h4>
            <f:if condition="{site.isConfigured}">
                <button type="button"
                        class="btn btn-sm btn-default ignitercf-test-connection"
                        data-site="{site.identifier}"
                        title="Test Cloudflare connection">
                    <core:icon identifier="actions-refresh" size="small" />
                    Test Connection
                </button>
            </f:if>
        </div>
    </div>

    <div class="card-body">
        <f:if condition="{site.isConfigured}">
            <f:then>
                <!-- Configured: Show green checkboxes -->
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li>
                                <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                                Zone ID: <code>{site.zoneId}</code>
                            </li>
                            <li>
                                <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                                API Token: <code>{site.apiTokenMasked}</code>
                            </li>
                            <li>
                                <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                                Site enabled
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <div class="ignitercf-connection-result" data-site="{site.identifier}">
                            <span class="text-muted">
                                <core:icon identifier="actions-question-circle" size="small" />
                                Click "Test Connection" to verify settings
                            </span>
                        </div>
                    </div>
                </div>
            </f:then>
            <f:else>
                <!-- Not configured: Show hints -->
                <f:for each="{site.hints}" as="hint">
                    <div class="alert alert-warning mb-2">
                        <strong>
                            <core:icon identifier="actions-exclamation-triangle" size="small" />
                            {hint.message}
                        </strong>
                        <div class="mt-2">
                            <strong>Solution:</strong>
                            <pre class="mb-1" style="font-size: 12px; background: #f5f5f5; padding: 8px; border-radius: 4px;"><f:format.raw>{hint.solution}</f:format.raw></pre>
                            <f:if condition="{hint.link}">
                                <small class="text-muted">
                                    <core:icon identifier="actions-link" size="small" />
                                    {hint.link}
                                </small>
                            </f:if>
                        </div>
                    </div>
                </f:for>

                <f:if condition="{site.zoneId}">
                    <p class="mb-1">
                        <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                        Zone ID: <code>{site.zoneId}</code>
                    </p>
                </f:if>

                <f:if condition="{site.hasApiToken}">
                    <p class="mb-1">
                        <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                        API Token: <code>{site.apiTokenMasked}</code>
                    </p>
                </f:if>
            </f:else>
        </f:if>
    </div>
</div>

</html>
