<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      data-namespace-typo3-fluid="true">

<div class="ignitercf-site-card {f:if(condition: site.isConfigured, then: 'configured', else: 'not-configured')}" data-site-identifier="{site.identifier}">
    <div class="site-header">
        <h4 class="site-title">
            <f:if condition="{site.isConfigured}">
                <f:then>
                    <span class="text-success">
                        <core:icon identifier="actions-check-circle" size="small" />
                    </span>
                </f:then>
                <f:else>
                    <span style="color: #F38020;">
                        <core:icon identifier="actions-exclamation-circle" size="small" />
                    </span>
                </f:else>
            </f:if>
            {site.identifier}
            <span class="site-url">({site.baseUrl})</span>
        </h4>
        <div class="d-flex align-items-center gap-2">
            <f:if condition="{site.isConfigured}">
                <f:then>
                    <span class="site-badge badge-configured">
                        <core:icon identifier="actions-check" size="small" /> <f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.configured" />
                    </span>
                </f:then>
                <f:else>
                    <span class="site-badge badge-warning">
                        <core:icon identifier="actions-exclamation-triangle" size="small" /> <f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.setupRequired" />
                    </span>
                </f:else>
            </f:if>
            <f:if condition="{site.isConfigured}">
                <button type="button"
                        class="btn btn-sm btn-default ignitercf-test-connection"
                        data-site="{site.identifier}"
                        title="{f:translate(key: 'LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.testConnectionTitle')}">
                    <core:icon identifier="actions-refresh" size="small" />
                    <f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.testButton" />
                </button>
                <f:if condition="{site.lastTestTime}">
                    <f:then>
                        <span class="text-muted" style="font-size: 0.9em; margin-left: 0.5rem;">
                            <f:switch expression="{site.lastTestStatus}">
                                <f:case value="success">
                                    <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                                </f:case>
                                <f:case value="failed">
                                    <span class="text-danger"><core:icon identifier="actions-close" size="small" /></span>
                                </f:case>
                                <f:defaultCase>
                                    <span class="text-muted"><core:icon identifier="actions-question-circle" size="small" /></span>
                                </f:defaultCase>
                            </f:switch>
                            {site.lastTestTime}
                        </span>
                    </f:then>
                </f:if>
            </f:if>
        </div>
    </div>

    <div class="site-body">
        <f:if condition="{site.isConfigured}">
            <f:then>
                 <!-- Configured: Show checklist -->
                 <div class="row">
                     <div class="col-md-6">
                          <ul class="ignitercf-checklist">
                              <li>
                                 <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                                 <f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.zoneId" />: <code>{site.zoneId}</code>
                             </li>
                             <li>
                                 <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                                 <f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.apiToken" />: <code>{site.apiTokenMasked}</code>
                             </li>
                             <li>
                                 <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                                 <f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.siteEnabled" />
                             </li>
                         </ul>
                     </div>
                    <div class="col-md-6">
                         <div class="ignitercf-connection-result" data-site="{site.identifier}">
                             <f:if condition="{site.lastTestTime}">
                                 <f:then>
                                      <f:switch expression="{site.lastTestStatus}">
                                          <f:case value="success">
                                              <span class="text-success">
                                                  <core:icon identifier="actions-check-circle" size="small" />
                                                  <strong>Verbindung erfolgreich</strong>
                                              </span>
                                              <br />
                                              <span class="text-muted" style="font-size: 0.9em; cursor: help;" title="{site.testTooltipTime}">Letzter Test: {site.lastTestTime}</span>
                                          </f:case>
                                          <f:case value="failed">
                                              <span class="text-danger">
                                                  <core:icon identifier="actions-close-circle" size="small" />
                                                  <strong>Verbindung fehlgeschlagen</strong>
                                              </span>
                                              <br />
                                              <span class="text-muted" style="font-size: 0.9em; cursor: help;" title="{site.testTooltipTime}">Letzter Test: {site.lastTestTime}</span>
                                          </f:case>
                                          <f:defaultCase>
                                              <span class="text-muted">
                                                  <core:icon identifier="actions-question-circle" size="small" />
                                                  <strong>Status unbekannt</strong>
                                              </span>
                                              <br />
                                              <span class="text-muted" style="font-size: 0.9em; cursor: help;" title="{site.testTooltipTime}">Letzter Test: {site.lastTestTime}</span>
                                          </f:defaultCase>
                                      </f:switch>
                                 </f:then>
                                 <f:else>
                                     <span class="text-muted">
                                         <core:icon identifier="actions-question-circle" size="small" />
                                         <f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.clickTest" />
                                     </span>
                                 </f:else>
                             </f:if>
                         </div>
                     </div>
                </div>
            </f:then>
            <f:else>
                <!-- Not configured: Show hints -->
                <f:for each="{site.hints}" as="hint">
                    <div class="ignitercf-hint">
                        <div class="hint-title">
                            <core:icon identifier="actions-exclamation-triangle" size="small" />
                            {hint.message}
                        </div>
                        <div>
                            <small class="text-muted"><f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.solution" />:</small>
                            <pre class="hint-solution"><f:format.raw>{hint.solution}</f:format.raw></pre>
                            <f:if condition="{hint.link}">
                                <span class="hint-link">
                                    <core:icon identifier="actions-link" size="small" />
                                    {hint.link}
                                </span>
                            </f:if>
                        </div>
                    </div>
                </f:for>

                <!-- Show what IS configured -->
                <f:if condition="{site.zoneId}">
                    <div style="margin-top: 0.5rem;">
                        <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                        <f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.zoneId" />: <code>{site.zoneId}</code>
                    </div>
                </f:if>

                <f:if condition="{site.hasApiToken}">
                    <div style="margin-top: 0.25rem;">
                        <span class="text-success"><core:icon identifier="actions-check" size="small" /></span>
                        <f:translate key="LLL:EXT:ignitercf/Resources/Private/Language/locallang.xlf:module.config.apiToken" />: <code>{site.apiTokenMasked}</code>
                    </div>
                </f:if>
            </f:else>
        </f:if>
    </div>
</div>

</html>
